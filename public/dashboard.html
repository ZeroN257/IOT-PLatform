<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Add Bootstrap stylesheet link -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
</head>
<body class="container mt-5">
    <h1 class="mb-4">Hello <span id="username"></span></h1>
    <p>Welcome to your dashboard!</p>

    <h2 class="mt-4">Device Information</h2>
    <div id="deviceContainer" class="mb-3">
        <!-- Devices will be added here dynamically -->
    </div>

    <div class="form-row">
        <div class="col-8">
            <input type="text" class="form-control" id="deviceName" placeholder="Device Name">
        </div>
        <div class="col-4">
            <select class="form-control" id="deviceList">
                <option value="Led">Led</option>
                <option value="DHT11">DHT11</option>
                <option value="Servo">Servo</option>
                <option value="Potentiometer">Potentiometer</option>
                <!-- Add more device options as needed -->
            </select>
        </div>
    </div>

    <button class="btn btn-primary mt-3" onclick="addDevice()">Add Device</button>
    <button class="btn btn-success mt-3" onclick="saveDevices()">Save Devices</button>
    <button class="btn btn-info mt-3" onclick="goToControlPage()">Go to Control Page</button>

    <a href="/" class="btn btn-danger mt-3">Logout</a>
    <script>
        // Get userName from local storage
        const username = localStorage.getItem('username');
        document.getElementById('username').innerText = username;
        //Go to control page
        function goToControlPage() {
            const selectedUsername = localStorage.getItem('username');
            window.location.href = `/control?username=${selectedUsername}`;
        }

        // Function to add a new device to the list
        function addDevice() {
            const deviceName = document.getElementById('deviceName').value;
            const deviceList = document.getElementById('deviceList');
            const selectedDevice = deviceList.options[deviceList.selectedIndex].value;


            // Create a new line for the device
            const deviceLine = document.createElement('div');
            // Updated line to include device ID
            deviceLine.innerHTML = `<p>${selectedDevice} - Name: ${deviceName} </p>`;
            
            // Append the new line to the device container
            document.getElementById('deviceContainer').appendChild(deviceLine);
        }

        // Function to save devices to the server
        async function saveDevices() {
            const deviceContainer = document.getElementById('deviceContainer');
            const devices = deviceContainer.getElementsByTagName('p');

            const username = localStorage.getItem('username'); // Get the user ID from local storage

            const deviceData = Array.from(devices).map(device => {
                const parts = device.innerText.split(' - ');
                return {
                    deviceType: parts[0], 
                    deviceName: parts[1].split(': ')[1] 
                };
            });
            

            // Send a request to the server to save device information
            const response = await fetch(`/api/saveDevices/${username}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(deviceData),
            });

            const data = await response.json();
            alert(data.message);

            // Clear the device container after saving
            deviceContainer.innerHTML = '';
        }
    </script>
</body>
</html>
